<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Liderl…ôr - Realtime</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        :root { --theme-red: #ff4d4d; --gold: #f1c40f; --silver: #bdc3c7; --bronze: #e67e22; --bg-gray: #f8f9fd; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-gray); margin: 0; display: flex; justify-content: center; }
        .leaderboard-container { width: 100%; max-width: 400px; background: white; min-height: 100vh; padding-bottom: 100px; }
        .header { padding: 30px 20px; text-align: center; }
        .top-three { display: flex; justify-content: center; align-items: flex-end; gap: 15px; margin: 20px 0 40px 0; min-height: 180px; }
        .top-user { display: flex; flex-direction: column; align-items: center; position: relative; width: 100px; }
        .rank-1 .avatar { width: 90px; height: 90px; border: 4px solid var(--gold); box-shadow: 0 10px 20px rgba(241, 196, 15, 0.3); }
        .rank-2 .avatar, .rank-3 .avatar { width: 75px; height: 75px; }
        .rank-2 .avatar { border: 3px solid var(--silver); }
        .rank-3 .avatar { border: 3px solid var(--bronze); }
        .avatar { border-radius: 50%; background: #eee; object-fit: cover; margin-bottom: 10px; }
        .crown { position: absolute; top: -20px; font-size: 24px; color: var(--gold); }
        .rank-badge { position: absolute; bottom: 45px; width: 24px; height: 24px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 12px; font-weight: bold; color: white; }
        .rank-1 .rank-badge { background: var(--gold); bottom: 55px; }
        .rank-2 .rank-badge { background: var(--silver); }
        .rank-3 .rank-badge { background: var(--bronze); }
        .top-name { font-weight: 700; font-size: 12px; text-align: center; }
        .top-balance { font-weight: 800; font-size: 11px; color: var(--theme-red); }
        .list-container { padding: 0 20px; }
        .list-item { display: flex; align-items: center; padding: 12px; background: #fff; border-radius: 18px; margin-bottom: 10px; border: 1px solid #f0f0f0; }
        .list-rank { width: 30px; font-weight: 800; color: #a0a0a0; }
        .list-avatar { width: 40px; height: 40px; border-radius: 50%; margin-right: 15px; }
        .list-info { flex: 1; }
        .list-name { font-weight: 600; font-size: 14px; }
        .list-balance { font-weight: 800; color: var(--theme-red); font-size: 13px; }
    </style>
</head>
<body>

<div class="leaderboard-container">
    <div class="header"><h1>üèÜ Liderl…ôr</h1></div>

    <div class="top-three" id="top-3-content">
        </div>

    <div class="list-container" id="leader-list-content">
        </div>
</div>

<script>
    // 1. FIREBASE KONFƒ∞QURASƒ∞YASI (√ñz m…ôlumatlarƒ±nƒ± bura yaz)
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
        projectId: "YOUR_PROJECT",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "YOUR_ID",
        appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const tg = window.Telegram.WebApp;
    const user = tg.initDataUnsafe?.user || { id: "guest", first_name: "Qonaq", photo_url: "" };

    // 2. ƒ∞STƒ∞FAD∆è√áƒ∞Nƒ∞ BAZAYA QEYD ET/YENƒ∞L∆è
    function syncUser() {
        // LocalStorage-dan balansƒ± g√∂t√ºr√ºr√ºk
        let myBalance = parseFloat(localStorage.getItem('balance_' + user.id)) || 0.0000;
        
        database.ref('users/' + user.id).set({
            name: user.first_name,
            photo: user.photo_url || `https://i.pravatar.cc/150?u=${user.id}`,
            balance: myBalance
        });
    }

    // 3. Lƒ∞DERL∆èRƒ∞ √á∆èK V∆è G√ñST∆èR
    function loadLeaderboard() {
        database.ref('users').orderByChild('balance').limitToLast(100).on('value', (snapshot) => {
            let users = [];
            snapshot.forEach((child) => {
                users.push(child.val());
            });
            users.reverse(); // √á√ºnki limitToLast ki√ßikd…ôn b√∂y√ºy…ô d√ºz√ºr

            renderUI(users);
        });
    }

    function renderUI(users) {
        const top3Div = document.getElementById('top-3-content');
        const listDiv = document.getElementById('leader-list-content');
        
        // ƒ∞lk 3 n…ôf…ôr
        let topHtml = '';
        const order = [1, 0, 2]; // Vizual olaraq: 2-ci yer | 1-ci yer | 3-c√º yer
        
        [1, 0, 2].forEach(idx => {
            if(users[idx]) {
                const u = users[idx];
                const rankClass = idx === 0 ? 'rank-1' : (idx === 1 ? 'rank-2' : 'rank-3');
                topHtml += `
                    <div class="top-user ${rankClass}">
                        ${idx === 0 ? '<i class="fa-solid fa-crown crown"></i>' : ''}
                        <img src="${u.photo}" class="avatar">
                        <div class="rank-badge">${idx + 1}</div>
                        <span class="top-name">${u.name}</span>
                        <span class="top-balance">${u.balance.toFixed(4)} ‚Çº</span>
                    </div>`;
            }
        });
        top3Div.innerHTML = topHtml;

        // Qalanlar (4-100)
        let listHtml = '';
        for(let i = 3; i < users.length; i++) {
            listHtml += `
                <div class="list-item">
                    <div class="list-rank">${i + 1}</div>
                    <img src="${users[i].photo}" class="list-avatar">
                    <div class="list-info">
                        <span class="list-name">${users[i].name}</span>
                        <span class="list-balance">${users[i].balance.toFixed(4)} ‚Çº</span>
                    </div>
                </div>`;
        }
        listDiv.innerHTML = listHtml;
    }

    syncUser();
    loadLeaderboard();
</script>
</body>
</html>
